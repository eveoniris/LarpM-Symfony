{% extends "base.html.twig" %}

{% block title %}{{ personnage.nom }} d√©tails{% endblock title %}

{% block body %}

	{# TODO : IF ADMIN : DO NOT ADD PERSONNAGE LIST !  #}
	{% include '_partials/breadcrumb.twig' with {'items' :
		[
			{'name' : 'Liste des personnages', 'route': path('personnage.list') },
			{'name' : "Detail de #{personnage.nom}" },
		]
	} %}
		
	<div class="well well-sm bs-component">
		<div class="header">
			<h5>Fiche de personnage</h5>
		</div>

		<h3>{% if personnage.isPnj() %}üé≠ PNJ - {% endif %}
			{{ personnage.nom }}{% if personnage.surnom %} <small>({{ personnage.surnom }})</small>{% endif %}
			
			{% if personnage.genre == 'Masculin' %}
				<i class="fa fa-mars" aria-hidden="true"></i>
			{% elseif personnage.genre == 'Feminin' %}
				<i class="fa fa-venus" aria-hidden="true"></i>
			{% else %}
				<i class="fa fa-transgender-alt" aria-hidden="true"></i>
			{% endif %}
			
			<small>{{ personnage.ageReel|default('x') }} ans ({{ personnage.age }})</small>
			
			{% if personnage.vivant %}<span class="text-success">Vivant</span>{% else %}<span class="text-danger">üíÄ Mort</span>{% endif %}
			
			<div class="pull-right">
				{{ personnage.classeName }}
			</div>
		</h3>

			<div class="row">
				<div class="col-md-4">

					<div class="panel panel-default">
						<small>(admin)</small>
						{% include 'personnage/fragment/information.twig' %}
					</div>
					<div class="panel panel-default">
						<small>(player)</small>
						{% include 'personnage/fragment/info.twig' %}
					</div>

					<div class="panel panel-default">
						<div class="header">
							<h5>Informations de jey</h5>
						</div>
						<nav class="navbar navbar-default" style="margin-bottom: 0;">
	  						<div class="container-fluid">
	  							<div class="collapse navbar-collapse">
	  								<ul class="nav navbar-nav navbar-right">
		  								<li class="dropdown">
		  								 	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								      			Action
								      			<span class="caret"></span>
								    		</a>
											<ul class="dropdown-menu">
												<li><a href="{{ path('personnage.admin.update.renomme', {'personnage': personnage.id}) }}">Modifier la Renomm√©e</a></li>
												<li><a href="{{ path('personnage.admin.update.heroisme', {'personnage': personnage.id}) }}">Modifier l'H√©ro√Øsme</a></li>
												<li><a href="{{ path('personnage.admin.update.pugilat', {'personnage': personnage.id}) }}">Modifier le Pugilat</a></li>
												<li><a href="{{ path('personnage.admin.update.domaine', {'personnage': personnage.id}) }}">Modifier la liste des domaines de magie</a></li>
												<li><a href="{{ path('personnage.admin.add.religion', {'personnage': personnage.id}) }}">Ajouter une religion</a></li>
												<li><a href="{{ path('personnage.admin.update.origine', {'personnage': personnage.id}) }}">Modifier l'origine</a></li>
												<li><a href="{{ path('personnage.admin.update.langue', {'personnage': personnage.id}) }}">Modifier les langages</a></li>
												<li><a href="{{ path('personnage.admin.update.sort', {'personnage': personnage.id}) }}">Modifier la liste des sorts</a></li>
												<li><a href="{{ path('personnage.admin.update.potion', {'personnage': personnage.id}) }}">Modifier la liste des potions</a></li>
												<li><a href="{{ path('personnage.admin.update.priere', {'personnage': personnage.id}) }}">Modifier la liste des prieres</a></li>
												<li><a href="{{ path('personnage.admin.update.technologie', {'personnage': personnage.id}) }}">Modifier la liste des technologies</a></li>
												<li><a href="{{ path('personnage.admin.update.connaissance', {'personnage': personnage.id}) }}">Modifier la liste des connaissances</a></li>
											</ul>
										</li>
	  								</ul>
	  							</div>
	  						</div>
	  					</nav>
	  					<div class="panel-body">
	  						<p>Origine : <strong class="text-success">{{ personnage.territoire|default("non d√©finie") }}</strong></p>
							<p>Renomm√©e : <strong class="text-success">{{ personnage.renomme|default(0) }}</strong>
								  	<a role="button" data-toggle="collapse" href="#renommeHistory" aria-expanded="false" aria-controls="collapseExample">
										<i class="fa fa-history" aria-hidden="true"></i>
									</a>
							</p>
							<div class="collapse" id="renommeHistory">
								<h6>Historique</h6>
								<div class="list-group">
									{% for historique in personnage.renommeHistories %}
										<div class="list-group-item">{{ historique.date|date("Y-m-d H:i:s") }} : {% if historique.renomme > 0 %}+{% endif %}{{ historique.renomme }} {% if historique.explication %} pour la raison suivante : "{{ historique.explication }}"{% endif %}.</div>
									{% endfor %}
								</div>
							</div>
							<p>H√©ro√Øsme : <strong class="text-success">{{ personnage.heroisme|default(0) }}</strong>
								<a role="button" data-toggle="collapse" href="#heroismeHistory" aria-expanded="false" aria-controls="collapseExample">
									<i class="fa fa-history" aria-hidden="true"></i>
								</a></p>
							<div class="collapse" id="heroismeHistory">
								<h6>Historique</h6>		
								<div class="list-group">
									{% for historique in personnage.displayHeroisme %}
										<div class="list-group-item">{{ historique.date|date("Y-m-d H:i:s") }} : {% if historique.heroisme > 0 %}+{% endif %}{{ historique.heroisme }} {% if historique.explication %} pour la raison suivante : "{{ historique.explication }}"{% endif %}.</div>
									{% endfor %}
								</div>
							</div>
							<p>Pugilat : <strong class="text-success">{{ personnage.pugilat|default(0) }}</strong>
								<a role="button" data-toggle="collapse" href="#pugilatHistory" aria-expanded="false" aria-controls="collapseExample">
									<i class="fa fa-history" aria-hidden="true"></i>
								</a></p>
							<div class="collapse" id="pugilatHistory">
								<h6>Historique</h6>		
								<div class="list-group">
									{% for historique in personnage.displayPugilat %}
										<div class="list-group-item">{{ historique.date|date("Y-m-d H:i:s") }} : {% if historique.pugilat > 0 %}+{% endif %}{{ historique.pugilat }} {% if historique.explication %} pour la raison suivante : "{{ historique.explication }}"{% endif %}.</div>
									{% endfor %}
								</div>
							</div>														
								
							<h6>Religions :</h6>
							<div class="list-group">
								{% for personnageReligion in personnage.personnagesReligions %}
									<div class="list-group-item">{% if personnageReligion.religion.secret %}<span style="color:red;">Secret</span> - {% endif %}{{ personnageReligion.religion.label }} - {{ personnageReligion.religionLevel.label }} - <a href="{{ path('personnage.admin.delete.religion', {'personnage': personnage.id, 'personnageReligion': personnageReligion.id }) }}">Supprimer</a></div>
								{% else %}
									<div class="list-group-item-text">Sans - Fervent</div>
								{% endfor %}
							</div>
							
							<h6>Langues connues :</h6>
							{% set languesAnomalie = personnage.getLanguesAnomaliesMessage() %}
							{% if languesAnomalie != "" %}
							<div class="text-warning">{{languesAnomalie}}</div>
							{% endif %}
							<div class="list-group">
								{% for personnageLangue in personnage.personnageLangues %}
									<div class="list-group-item">{% if personnageLangue.langue.secret %}<span style="color:red;">Secret</span> - {% endif %}<strong>{{ personnageLangue.langue}}</strong> ({{ personnageLangue.source }}) - <a href="{{ path('personnage.admin.delete.langue', {'personnage': personnage.id, 'personnageLangue' : personnageLangue.id }) }}">Supprimer</a></div>
								{% endfor %}
							</div>

							<h6>Domaines de magie :</h6>
							<div class="list-group">
								{% for domaine in personnage.domaines %}
									<div class="list-group-item">{{ domaine.label }}</div>
								{% else %}
									<div class="list-group-item">Aucun</div>
								{% endfor %}
							</div>

							<h6>Sorts :</h6>
							{% set sortAnomalie = personnage.getSortAnomalieMessage() %}
							{% if sortAnomalie != "" %}
							<div class="text-warning">{{sortAnomalie}}</div>
							{% endif %}
							<div class="list-group">
								<div class="list-group-item">
									{% for sort in personnage.sorts %}
										<div class="list-group-item-text">{% if sort.secret %}<span style="color:red;">Secret</span> - {% endif %}{{ sort.label }} - {{ sort.domaine.label }} Niveau {{ sort.niveau }}</div>
									{% else %}
										<div class="list-group-item-text">Aucun</div>
									{% endfor %}
								</div>
							</div>

							<h6>Potions :</h6>
							{% set potionsAnomalie = personnage.getPotionAnomalieMessage() %}
							{% if potionsAnomalie != "" %}
							<div class="text-warning">{{potionsAnomalie}}</div>
							{% endif %}
							<div class="list-group">
								<div class="list-group-item">
									{% for potion in personnage.potions %}
										<div class="list-group-item-text">{% if potion.secret %}<span style="color:red;">Secret</span> - {% endif %}{{ potion.label }} - Niveau {{ potion.niveau }}</div>
									{% else %}
										<div class="list-group-item-text">Aucune</div>
									{% endfor %}
								</div>
							</div>

							<h6>Pri√®res :</h6>
							{% set sortAnomalie = personnage.getPrieresAnomalieMessage() %}
							{% if sortAnomalie != "" %}
							<div class="text-warning">{{sortAnomalie}}</div>
							{% endif %}
							<div class="list-group">
								<div class="list-group-item">
									{% for priere in personnage.prieres %}
										<div class="list-group-item-text">{{ priere.sphere.label }} - Niveau {{ priere.niveau }} ({{ priere.label }})</div>
									{% else %}
										<div class="list-group-item-text">Aucune</div>
									{% endfor %}
								</div>
							</div>

							<h6>Technologies :</h6>
							<div class="list-group">
								<div class="list-group-item">
									{% for technologie in personnage.technologies %}
										<div class="list-group-item-text">{% if technologie.secret %}<span style="color:red;">Secret</span> - {% endif %}{{ technologie.label }}</div>
									{% else %}
										<div class="list-group-item-text">Aucune</div>
									{% endfor %}
								</div>
							</div>

							<h6>Connaissances :</h6>
							<div class="list-group">
								<div class="list-group-item">
									{% for connaissance in personnage.connaissances %}
										<div class="list-group-item-text">{% if connaissance.secret %}<span style="color:red;">Secret</span> - {% endif %}{{ connaissance.label }}</div>
									{% else %}
										<div class="list-group-item-text">Aucune</div>
									{% endfor %}
								</div>
							</div>							
						</div>
					</div>
					
					<div class="panel panel-default">
						<div class="header">
							<h5>Technique</h5>
						</div>
						<nav class="navbar navbar-default" style="margin-bottom: 0;">
	  						<div class="container-fluid">
	  							<div class="collapse navbar-collapse">
	  								<ul class="nav navbar-nav navbar-right">
		  								<li class="dropdown">
		  								 	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								      			Action
								      			<span class="caret"></span>
								    		</a>
											<ul class="dropdown-menu">
												<!-- <li><a href="{{ path('personnage.admin.token.add', {'personnage': personnage.id, 'token': 'VIEILLESSE'}) }}">Ajouter un jeton vieillesse</a></li>-->
												<li><a href="{{ path('personnage.admin.trigger.add', {'personnage': personnage.id}) }}">Ajouter un d√©clencheur de comp√©tences</a></li>
											</ul>
										</li>
	  								</ul>
	  							</div>
	  						</div>
	  					</nav>
					
						<div class="panel-body">
							<h6>Jetons de vieillesse</h6>
							<div class="list-group">
								{% for personnageToken in personnage.personnageHasTokens %}
									<div class="list-group-item">
										{{ personnageToken.token.label }}
										-- <a href="{{ path('personnage.admin.token.delete', {'personnage': personnage.id, 'personnageHasToken': personnageToken.id}) }}">Supprimer</a>
									</div>
								{% else %}
									<div class="list-group-item">La liste est vide</div>
								{% endfor %}
							</div>
									
							<h6>D√©clencheurs de comp√©tences</h6>
							<div class="list-group">
								{% for trigger in personnage.personnageTriggers %}
									<div class="list-group-item">
										{{ trigger.tag }}
										-- <a href="{{ path('personnage.admin.trigger.delete', {'personnage': personnage.id, 'trigger': trigger.id}) }}">Supprimer</a>
									</div>
								{% else %}
									<div class="list-group-item">La liste est vide</div>
								{% endfor %}
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-4">


					<div class="panel panel-default">
						<div class="header">
							<h5>Photo</h5>
						</div>
						<nav class="navbar navbar-default" style="margin-bottom: 0;">
	  						<div class="container-fluid">
	  							<div class="collapse navbar-collapse">
	  								<ul class="nav navbar-nav navbar-right">
		  								<li class="dropdown">
		  								 	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								      			Action
								      			<span class="caret"></span>
								    		</a>
											<ul class="dropdown-menu">
												<li><a href="{{ path('personnage.trombine.update', {'personnage': personnage.id}) }}">Modifier la trombine</a></li>
											</ul>
										</li>
	  								</ul>
	  							</div>
	  						</div>
	  					</nav>
					
						<div class="thumbnail">
							{% if personnage.trombineUrl %}
								<img class="media-object" width="200" src="{{ path('personnage.trombine', {'personnage' : personnage.id }) }}" />
							{% else %}
								<img class="media-object" width="200" src="{{ app.request.basepath }}/img/no_trombine.png" />
							{% endif %}
						</div>
					</div>
				
					<div class="panel panel-default">
						<div class="header">
							<h5>Enveloppe</h5> {# TODO ADMIN #}
						</div>
						<nav class="navbar navbar-default" style="margin-bottom: 0;">
	  						<div class="container-fluid">
	  							<div class="collapse navbar-collapse">
	  								<ul class="nav navbar-nav navbar-right">
		  								<li class="dropdown">
		  								 	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								      			Action
								      			<span class="caret"></span>
								    		</a>
											<ul class="dropdown-menu">
												<li><a href="{{ path('personnage.documents', {'personnage': personnage.id}) }}">Modifier la liste des documents</a></li>
												<li><a href="{{ path('personnage.items', {'personnage': personnage.id}) }}">Modifier la liste des objets</a></li>
												<li><a href="{{ path('personnage.admin.update.ingredient', {'personnage': personnage.id}) }}">Modifier la liste des ingr√©dients</a></li>
												<li><a href="{{ path('personnage.admin.update.ressource', {'personnage': personnage.id}) }}">Modifier la liste des ressources</a></li>
												<li><a href="{{ path('personnage.admin.update.richesse', {'personnage': personnage.id}) }}">Modifier la richesse</a></li>
												<li><a href="{{ path('personnage.update.materiel', {'personnage': personnage.id}) }}">Modifier le mat√©riel</a></li>
												<li><a href="{{ path('personnage.enveloppe.print', {'personnage':personnage.id}) }}">Imprimer l'enveloppe</a></li>
											</ul>
										</li>
	  								</ul>
	  							</div>
	  						</div>
	  					</nav>
						<div class="panel-body">
							<div class="list-group">
							
								<div class="list-group-item">
									<h6 class="list-group-item-heading">Renomm√©e : {{ personnage.renomme|default(0) }}</h6>
								</div>
					
								<div class="list-group-item">
									<h6 class="list-group-item-heading">Richesse : {{ personnage.richesse|default(0) }} pi√®ces d'argent</h6>
								</div>
								
								<div class="list-group-item">
									<h6 class="list-group-item-heading">Li√© aux comp√©tences :</h6>
									{% for competence in personnage.competences %}
									{% if competence.materiel %}
										<div class="list-group-item-text"><strong>{{ competence.competenceFamily.label }}&nbsp({{ competence.level.label }}) : </strong>
											{{ competence.materielRaw }}
										</div>
									{% else %}
										<div class="list-group-item-text">Aucun</div>
									{% endif %}
									{% endfor %}
								</div>

								{% if personnage.hasCompetence('Pr√™trise') %}
								<div class="list-group-item">
									{% set enoughReligion = 0 %}
									<h6 class="list-group-item-heading">Divinit√© principale :</h6>
									{% for religion in personnage.personnagesReligions %}
									{% if religion.religionLevel.index >= 2 %}
										{% set enoughReligion = 1 %}
										<div class="list-group-item-text"><strong>{{ religion.religion }}</strong> ({{ religion.religionLevel.label }})</div>
									{% endif %}
									{% endfor %}
									{% if enoughReligion == 0 %}
										<div class="list-group-item-text">CE PR√äTRE N'A PAS ASSEZ DE FERVEUR</div>
									{% endif %}
								</div>
								{% endif %}
								<div class="list-group-item">
									<h6 class="list-group-item-heading">Li√© aux langues :</h6>
									{% for materiel in personnage.langueMateriel %}
											<div class="list-group-item-text"><strong>{{ materiel }}</strong></div>
									{% else %}
										<div class="list-group-item-text">Aucun</div>
									{% endfor %}
								</div>
								
								<div class="list-group-item">
									<h6 class="list-group-item-heading">Documents :</h6>
									{% for document in personnage.documents %}
										<div class="list-group-item-text"><a href="{{ path('document.detail', {'document':document.id}) }}"><strong>{{ document.code }}</strong> - {{ document.titre }}</a></div>
									{% else %}
										<div class="list-group-item-text">Aucun</div>
									{% endfor %}
								</div>
							
								<div class="list-group-item">
									<h6 class="list-group-item-heading">Objets :</h6>
									{% for item in personnage.items %}
										<div class="list-group-item-text"><a href="{{ path('item.detail', {'item':item.id}) }}"><strong>{{ item.numero }}</strong> - {{ item.label }}</a></div>
									{% else %}
										<div class="list-group-item-text">Aucun</div>
									{% endfor %}
								</div>
								
								<div class="list-group-item">
									<h6 class="list-group-item-heading">Ingr√©dients :</h6>
									{% for personnageIngredient in personnage.personnageIngredients %}
										<div class="list-group-item-text">{{personnageIngredient.nombre}} {{ personnageIngredient.ingredient }} - {{ personnageIngredient.ingredient.color }} : {{ personnageIngredient.ingredient.dose }} (Niveau {{ personnageIngredient.ingredient.niveau }})</div>
									{% else %}
										<div class="list-group-item-text">Aucun</div>
									{% endfor %}
								</div>
								
								<div class="list-group-item">
									<h6 class="list-group-item-heading">Ressources :</h6>
									{% for personnageRessource in personnage.personnageRessources %}
										<div class="list-group-item-text">{{personnageRessource.nombre}} {{ personnageRessource.ressource }}</div>
									{% else %}
										<div class="list-group-item-text">Aucune</div>
									{% endfor %}
								</div>
								
								<div class="list-group-item">
									<h6 class="list-group-item-heading">Mat√©riel :</h6>
									{% if personnage.materiel %}
									{{ personnage.materiel }}
									{% else %}
										<div class="list-group-item-text">Aucun</div>
									{% endif %}
								</div>
							</div>
						</div>
					</div>

					<div class="panel panel-default">
						{% include 'personnage/fragment/religion.twig' with {'personnage' : personnage} %}
					</div>
				</div>
				<div class="col-md-4">
				
					<div class="panel panel-default">
						<div class="header">
							<h5>Comp√©tences <small>({{ personnage.xp|default(0) }} / {{ personnage.xpTotal }} xp)</small></h5>
						</div>

						<nav class="navbar navbar-default" style="margin-bottom: 0;">
	  						<div class="container-fluid">
	  							<div class="collapse navbar-collapse">
	  								<a class="btn btn-default navbar-btn" role="button" data-toggle="collapse" href="c#xpHistory" aria-expanded="false" aria-controls="collapseExample">
										<i class="fa fa-history" aria-hidden="true"></i>
									</a>
	  								<ul class="nav navbar-nav navbar-right">
		  								<li class="dropdown">
		  								 	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								      			Action
								      			<span class="caret"></span>
								    		</a>
											<ul class="dropdown-menu">
												<li><a href="{{ path('personnage.admin.xp', {'personnage':personnage.id}) }}">Ajouter des points d'exp√©rience</a></li>
												<li><a href="{{ path('personnage.admin.add.competence', {'personnage':personnage.id}) }}">Ajouter une comp√©tence</a></li>
												<li><a href="{{ path('personnage.admin.delete.competence', {'personnage':personnage.id}) }}">Retirer la derni√®re comp√©tence acquise</a></li>
											</ul>
										</li>
	  								</ul>
	  							</div>
	  						</div>
	  					</nav>
						<div class="panel-body">
							
							<div class="list-group">
								{% for competence in personnage.competences %}
									<div class="list-group-item">{{ competence.competenceFamily.label }}&nbsp({{ competence.level.label }})</div>					
								{% endfor %}
							</div>
							
							<div class="collapse" id="xpHistory">
								<h6>Historique</h6>		
									
								<div class="list-group">
									{% for historique in personnage.experienceGains %}
										<div class="list-group-item">{{ historique.operationDate|date("Y-m-d H:i:s") }} : + {{ historique.xpGain }} xp {% if historique.explanation %} pour la raison suivante : "{{ historique.explanation }}"{% endif %}.</div>
									{% endfor %}
									{% for historique in personnage.experienceUsages %}
										<div class="list-group-item">{{ historique.operationDate|date("Y-m-d H:i:s") }} : - {{ historique.xpUse }} xp pour acqu√©rir {{ historique.competence.label }}.</div>
									{% endfor %}
								</div>
							</div>
						</div>
					</div>

					{% if personnage.personnageLignee %}
					<div class="panel panel-default">
						<div class="header">
							<h5>Lign√©e & G√©n√©alogie</h5>
						</div>
						<nav class="navbar navbar-default" style="margin-bottom: 0;">
	  						<div class="container-fluid">
								{% if personnage.personnageLignee|length == 0 %}
	  							<div class="collapse navbar-collapse">
	  								<ul class="nav navbar-nav navbar-right">
		  								<li class="dropdown">
		  								 	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								      			Action
								      			<span class="caret"></span>
								    		</a>
											<ul class="dropdown-menu">
												<li><a href="{{ path('personnage.admin.add.lignee', {'personnage': personnage.id}) }}">Ajouter une lign√©e</a></li>
											</ul>
										</li>
	  								</ul>
	  							</div>
								{% else %}
								<div class="collapse navbar-collapse">
									<ul class="nav navbar-nav navbar-right">
										<li class="dropdown">
											<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
												Action
												<span class="caret"></span>
											</a>
											{% for lignage in personnage.personnageLignee %}
											<ul class="dropdown-menu">
												<li><a href="{{ path('personnage.admin.delete.lignee', {'personnage': personnage.id, 'personnageLignee' : lignage.id }) }}">Retirer</a></li>
											</ul>
											{% endfor %}
										</li>
									</ul>
								</div>
								{% endif %}
	  						</div>
	  					</nav>
	  					<div class="panel-body">
							<div class="list-group">
								{# Gestion de la lign√©e du personnage #}
								{% if personnage.personnageLignee|length > 0 %}
									{% for lignage in personnage.personnageLignee %}
										{% if lignage.lignee %}<div class="list-group-item">
											Lign√©e :<a href="{{ path('lignee.detail', {'lignee':lignage.lignee.id}) }}"> {{ lignage.lignee.nom }}</a></div>
										{% endif %}
										<li class="list-group-item">
											<strong>Parents :</strong>
											<ul>
										{% if lignage.parent1 %}
											<li>
												<a href="{{ path('personnage.admin.detail', {'personnage':lignage.parent1.id}) }}">{{ lignage.parent1.identity }}</a> - {{ lignage.parent1.agereel }} ans
											</li>												
											{% if lignage.parent2 %}
											<li>
												<a href="{{ path('personnage.admin.detail', {'personnage':lignage.parent2.id}) }}">{{ lignage.parent2.identity }}</a> - {{ lignage.parent2.agereel }} ans
											</li>
											{% endif %}
										{% else %}
											<li>Ni PJ, ni PNJ</li>
										{% endif %}
											</ul>
										</li>
									{% endfor %}
								{% else %}
									<p class="list-group-item-text">
										Ce personnage n'a pas de lign√©e.
									</p>
								{% endif %}
								{% if descendants|length > 0 %}
									<li class="list-group-item">
										<strong>Enfants :</strong>
										<ul>
									{% for descendant in descendants %}
										<li><a href="{{ path('personnage.admin.detail', {'personnage':descendant.personnage.id}) }}">{{ descendant.personnage.identity }}</a> - {{ descendant.personnage.agereel }} ans</li>
									{% endfor %}
									</ul></li>
								{% endif %}								
							</div>
						</div>
					</div>
					{% endif %}

					<div class="panel panel-default">
						<div class="header">
							<h5>Chronologie</h5>
						</div>
						<nav class="navbar navbar-default" style="margin-bottom: 0;">
	  						<div class="container-fluid">
	  							<div class="collapse navbar-collapse">
	  								<ul class="nav navbar-nav navbar-right">
		  								<li class="dropdown">
		  								 	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								      			Action
								      			<span class="caret"></span>
								    		</a>
											<ul class="dropdown-menu">
												<li><a href="{{ path('personnage.admin.add.chronologie', {'personnage': personnage.id}) }}">Ajouter un evenement</a></li>
											</ul>
										</li>
	  								</ul>
	  							</div>
	  						</div>
	  					</nav>
	  					<div class="panel-body">
							<div class="list-group">
								{# Gestion de la chronologie du personnage #}
								{% if personnage.personnageChronologie|length > 0 %}
									{% for personnageChronologie in personnage.personnageChronologie %}
										<div class="list-group-item">{{ personnageChronologie.annee }} : {{ personnageChronologie.evenement }}</div>
									{% endfor %}
								{% else %}
									<p class="list-group-item-text">
										Ce personnage n'a pas de chronologie.
									</p>
								{% endif %}
							</div>
						</div>
					</div>
					
					<div class="panel panel-default">
						<div class="header">
							<h5>Background</h5>
						</div>
						<nav class="navbar navbar-default" style="margin-bottom: 0;">
	  						<div class="container-fluid">
	  							<div class="collapse navbar-collapse">
	  								<ul class="nav navbar-nav navbar-right">
		  								<li class="dropdown">
		  								 	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								      			Action
								      			<span class="caret"></span>
								    		</a>
											<ul class="dropdown-menu">
												<li><a href="{{ path('personnage.admin.add.background', {'personnage': personnage.id}) }}">Ajouter un background</a></li>
											</ul>
										</li>
	  								</ul>
	  							</div>
	  						</div>
	  					</nav>
	  					<div class="panel-body">
							<div class="list-group">
								<div class="list-group-item">
									{# Gestion du background du personnage #}
									{% if personnage.personnageBackgrounds|length > 0 %}
										{% for background in personnage.personnageBackgrounds %}
											<h6 class="list-group-item-heading">Background ({{ background.gn.label }}) - <strong>{{ background.visibility }}</strong></h6>
											<a href="{{ path('personnage.admin.update.background', {'personnage': personnage.id, 'background': background.id}) }}">Modifier le background</a>
											{{ background.text|markdown_to_html }}
										{% endfor %}
									{% else %}
										<p class="list-group-item-text">
											Ce personnage n'a pas de background individuel.
										</p>
									{% endif %}
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
	</div>
				
{% endblock body %}
